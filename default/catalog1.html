<polymer-element name="catalog-1" attributes="page muts iDB iLoad">
    <template>

        <style>
            :host {font-family: 'RobotoDraft', sans-serif;}

            @media (max-width: 430px) {
                .chip img {width: 290px;}
                .chip{box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 1); margin: 0px 2px 15px 2px;}
            }

            @media (min-width: 431px) {
                .chip img {width: 230px;}
                .chip{box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.16); margin: 0px 2px 10px 2px;}
            }

            .chip {
                display: inline-block;
                border-radius: 3px;
                text-align: start;
                background-color: #fff;
				box-sizing: border-box;
            }

            .chip:hover {box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 1);}
            .chip-bottom {padding: 8px; line-height: 1.5;}
            .chip-album-title {font-weight: bold;}
			
			.big {width:300px;}

            .card {
                height: 400px;
                border-radius: 3px;
                text-align: start;
                background: #fff;
                box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            }

            .card:hover {box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 1);}
            .card-left {width: 300px;}
            .card-right {padding: 24px;}
            .card-album-title {font-size: 2em;}
				
			section {padding-top:5px;}

            paper-fab {
                color: #FFF;
                background: #38D3D8;
            }
        </style>

        <core-animated-pages fit selected="{{page}}">
		<!--core-animated-pages fit selected="{{page}}" transitions="hero-transition"-->

            <section>
                <div style="text-align:center" hero-p on-tap="{{transition}}">

                    <template repeat="{{items as item}}">
                        <div class="chip" hero-id="{{item.artist}}-{{item.album}}" hero?="{{muts === item }}" on-tap="{{open}}">
                            <div class="chip-top" hero-id="{{item.artist}}-{{item.album}}-art" hero?="{{muts === item}}">
                            	<img id="{{item.id}}" src="{{item.bg}}">
                            </div>
                            <div layout horizontal class="chip-bottom">
                                <div flex>
                                    <div class="chip-album-title">{{item.album}}</div>
                                    <div class="chip-artist">{{item.artist}}</div>
                                </div>
                                <paper-fab class="{{item.album}} {{item.artist}}" icon="add-shopping-cart" on-tap="{{add}}"></paper-fab>
                            </div>
                        </div>
                    </template>

                </div>
            </section>

            <section layout vertical center center-justified>

                <div layout horizontal class="card" hero-id="{{muts.artist}}-{{muts.album}}" hero on-tap="{{transition}}">
                    <div class="card-left" hero-id="{{muts.artist}}-{{muts.album}}-art" hero>
                    	<img class="big" src="{{muts.bg}}">
                    </div>
                    <div class="card-right" flex layout vertical>
                        <div class="card-album-title">{{muts.album}}</div>
                        <div flex class="card-album-artist">{{muts.artist}}</div>
                        <paper-fab self-end class="{{muts.album}} {{muts.artist}}" icon="add-shopping-cart" on-tap="{{add}}"></paper-fab>
                    </div>
                </div>
					
            </section>

        </core-animated-pages>
		
    </template>

    <script>

        Polymer('catalog-1', {

            iDB:null,
            iLoad:null,
            page:0,
			
			muts: null,

            items: [
                { id: 'm01', album: 'Classic', artist: 'Blue', color: '#59D6F9', bg: 'muts/Classic-Blue.png' },
                { id: 'm02', album: 'Classic', artist: 'Coral', color: '#972ff8', bg: 'muts/Classic-Coral.png' },
                { id: 'm03', album: 'Classic', artist: 'Purple', color: '#7dd6fe', bg: 'muts/Classic-Purple.png' },
                { id: 'm04', album: 'Original', artist: 'Blue Orange Green', color: '#dc3c84', bg: 'muts/Original-Blue-Orange-Green.png' },
                { id: 'm05', album: 'Original', artist: 'Brown Pink Orange', color: '#f4db33', bg: 'muts/Original-Brown-Pink-Orange.png' },
                { id: 'm06', album: 'Original', artist: 'Sand Blue', color: '#972ff8', bg: 'muts/Original-Sand-Blue.png' },
                { id: 'm07', album: 'Special', artist: 'Sunrise', color: '#f4db33', bg: 'muts/Sunrise.png' },
                { id: 'm08', album: 'Special', artist: 'Sunset', color: '#972ff8', bg: 'muts/Sunset.png' },
                { id: 'm09', album: 'Limited edition', artist: 'Shell', color: '#7dd6fe', bg: 'muts/Shell.png' },
                { id: 'm10', album: 'Limited edition', artist: 'Stone', color: '#dc3c84', bg: 'muts/Stone.png' }
            ],

            transition: function(e) {
                if (e.target.localName === 'paper-fab') {return 0}
                if (document.body.clientWidth<431){return 0}
                if (this.page === 0 && e.target.templateInstance.model.item) {
					this.page = 1;
                    this.muts = e.target.templateInstance.model.item;
                } else {
                    this.page = 0;
                }
            },
			
			mutsChanged: function(e){
				if(document.body.clientWidth>430){return 0}
				var x=this.shadowRoot.querySelector("#"+this.muts.id)
				if (x){setTimeout(function(){x.scrollIntoView()},1000)}
			},

            add:function(e){
                var key=e.target.className
                var tx=this.iDB.result.transaction(["store"], "readwrite").objectStore("store");
                var qty=1
                req = tx.get(key)
                req.onsuccess = function(e) {
                    var value = e.target.result;
                    if (value) qty=value.qty+1
                    console.debug(value,qty)
                    req = tx.put({muts: key, qty:qty, price: "40"})
                    req.onsuccess = function (e) {
                        this.iLoad = !this.iLoad
                    }.bind(this)
                }.bind(this)
            },

            write:function(tx){
                var customerData = [
                    {muts: "Classic Blue", qty: "1", price:"40"},
                    {muts: "Classic Coral", qty: "1", price:"40"},
                    {muts: "Special Sunrise", qty: "2", price:"40"}
                ]
                for (var i in customerData){tx.put(customerData[i])}
            }
			
        });

    </script>

</polymer-element>
